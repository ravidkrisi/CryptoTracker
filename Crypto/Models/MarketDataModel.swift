//
//  MarketDataModel.swift
//  Crypto
//
//  Created by Ravid Krisi on 24/10/2024.
//

import Foundation

// JSON data
/*
 
 URL: https://api.coingecko.com/api/v3/global
  
 JSON response:
 {"data":{"active_cryptocurrencies":14997,"upcoming_icos":0,"ongoing_icos":49,"ended_icos":3376,"markets":1140,"total_market_cap":{"btc":35972554.047376886,"eth":949177566.5485053,"ltc":34528491544.05059,"bch":6795121444.27967,"bnb":4098647408.1842914,"eos":5135735767350.752,"xrp":4578232360986.534,"xlm":25335920193632.152,"link":211694029116.1969,"dot":571341988351.8788,"yfi":489499513.70855725,"usd":2422431745261.015,"aed":8897591800343.697,"ars":2380858213892022.5,"aud":3643143550332.9395,"bdt":289164151299807.94,"bhd":911578022763.9355,"bmd":2422431745261.015,"brl":13783152144186.125,"cad":3349079715912.2207,"chf":2098082669161.0378,"clp":2285312966221836.5,"cny":17237055326579.293,"czk":56735771483326.41,"dkk":16749037072042.469,"eur":2245281734161.822,"gbp":1873852697092.6973,"gel":6637462982015.1875,"hkd":18817340787759.027,"huf":905408089108757.1,"idr":3.776124747638635e+16,"ils":9189567498600.025,"inr":203671135409186.5,"jpy":369218568101577.0,"krw":3.339737983363544e+15,"kwd":742044137071.8448,"lkr":710226637063193.9,"mmk":5.082261801557597e+15,"mxn":48008452410357.29,"myr":10540000523630.695,"ngn":3.978529225464326e+15,"nok":26569715868371.863,"nzd":4027418742947.199,"php":140521641584700.73,"pkr":672113263595357.5,"pln":9758868027917.307,"rub":232281781514553.38,"sar":9097025761067.562,"sek":25644346941682.15,"sgd":3198445642696.657,"thb":81787351799374.92,"try":83040398223382.84,"twd":77637726219743.0,"uah":99824446701439.31,"vef":242558090652.9856,"vnd":6.1576910482617736e+16,"zar":43060541095823.48,"xdr":1815542342552.52,"xag":71565295442.30971,"xau":889880301.6216333,"bits":35972554047376.88,"sats":3597255404737688.5},"total_volume":{"btc":1628276.8224391127,"eth":42963972.75418894,"ltc":1562912169.6757076,"bch":307577236.2120166,"bnb":185522900.8567789,"eos":232466104717.92636,"xrp":207231035953.6081,"xlm":1146815752146.0876,"link":9582207607.629944,"dot":25861464162.216732,"yfi":22156911.953405783,"usd":109649969795.14897,"aed":402744339057.58167,"ars":107768167978521.72,"aud":164904782574.32016,"bdt":13088847814965.965,"bhd":41262051183.70307,"bmd":109649969795.14897,"brl":623886398140.4387,"cad":151594153440.94772,"chf":94968496739.39735,"clp":103443367685757.61,"cny":780225325074.3627,"czk":2568111832922.211,"dkk":758135461459.3702,"eur":101631377153.99951,"gbp":84818856935.27917,"gel":300440917238.7085,"hkd":851756031120.0765,"huf":40982772710634.89,"idr":1.709240994431722e+15,"ils":415960449916.9919,"inr":9219055971112.484,"jpy":16712464621282.393,"krw":151171305328178.16,"kwd":33588198047.589634,"lkr":32147997339466.145,"mmk":230045636630222.0,"mxn":2173074790241.5383,"myr":477087018578.6941,"ngn":180085820892458.5,"nok":1202662798707.153,"nzd":182298776582.8649,"php":6360630711461.786,"pkr":30422817565994.68,"pln":441729508618.4894,"rub":10514100294821.654,"sar":411771601770.8775,"sek":1160776510245.4058,"sgd":144775789369.1761,"thb":3702057105208.713,"try":3758775525784.721,"twd":3514226706949.6313,"uah":4518495758257.529,"vef":10979251475.588274,"vnd":2.787243185574302e+15,"zar":1949110450586.1191,"xdr":82179472512.34018,"xag":3239361645.165631,"xau":40279916.404247954,"bits":1628276822439.1128,"sats":162827682243911.28},"market_cap_percentage":{"btc":54.963900778118344,"eth":12.685160916110604,"usdt":4.9583730762773,"bnb":3.5593730464009274,"sol":3.3881295755543968,"usdc":1.4195539614840915,"xrp":1.238545016361375,"steth":1.0260290419586386,"doge":0.8483407486280591,"trx":0.5787277373420139},"market_cap_change_percentage_24h_usd":-1.3156507947447562,"updated_at":1729740476}}
 */

struct GlobalData: Codable {
    let data: MarketDataModel?
}

struct MarketDataModel: Codable {
    let totalMarketCap, totalVolume, marketCapPercentage: [String: Double]
    let marketCapChangePercentage24HUsd: Double
    
    enum CodingKeys: String, CodingKey {
        case totalMarketCap = "total_market_cap"
        case totalVolume = "total_volume"
        case marketCapPercentage = "market_cap_percentage"
        case marketCapChangePercentage24HUsd = "market_cap_change_percentage_24h_usd"
    }
    
    var marketCap: String {
        if let item = totalMarketCap.first(where: { $0.key == "usd" }) {
            return "\(item.value)"
        }
        return ""
    }
    
    var volume: String {
        if let item = totalVolume.first(where: { $0.key == "usd"}) {
            return "\(item.value)"
        }
        return ""
    }
    
    var btcDominance: String {
        if let item = marketCapPercentage.first(where: { $0.key == "btc"}) {
            return item.value.asPrecentString()
        }
        return ""
    }
}

